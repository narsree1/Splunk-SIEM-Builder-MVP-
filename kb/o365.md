# Office 365 (Microsoft 365) Integration Guide

## Overview

This document provides guidance for integrating Microsoft 365 logs into Splunk. M365 logs provide visibility into user activities, security events, compliance alerts, and administrative actions across Exchange, SharePoint, Teams, and other services.

**Log Source Type:** API-based (Management Activity API)  
**Vendor:** Microsoft  
**Category:** Cloud Services / Productivity Suite  
**Primary Index:** `o365`  
**Sourcetypes:** `o365:management:activity`, `ms:o365:management:activity`

## Pre-requisites

Before beginning the integration, ensure the following requirements are met:

1. **Microsoft 365 Subscription** - E3/E5 or equivalent
2. **Azure AD App Registration** - Service principal with permissions
3. **Unified Audit Logging** - Enabled in M365 Security & Compliance
4. **Splunk Infrastructure** - Active Splunk deployment
5. **Splunk Add-on for Microsoft Office 365** - Downloaded from Splunkbase

## Network Connectivity Requirements

| Source | Destination | Port | Protocol | Purpose |
|--------|-------------|------|----------|---------|
| Splunk HF | login.microsoftonline.com | 443 | HTTPS | OAuth authentication |
| Splunk HF | manage.office.com | 443 | HTTPS | Management Activity API |
| Splunk HF | graph.microsoft.com | 443 | HTTPS | Additional APIs |

## Logging Standard

### Recommended Content Types

| Content Type | Description | Priority |
|--------------|-------------|----------|
| Audit.AzureActiveDirectory | Azure AD events | High |
| Audit.Exchange | Exchange Online events | High |
| Audit.SharePoint | SharePoint/OneDrive events | High |
| Audit.General | General audit events | High |
| DLP.All | Data Loss Prevention events | Medium |

### Key Event Types

- User sign-ins and failures
- File access and sharing
- Mailbox access events
- Administrative changes
- Security alerts

## Log Collection Standard

### Source-Side Steps (Microsoft 365)

#### Step 1: Enable Unified Audit Logging

1. Go to Microsoft 365 Admin Center
2. Navigate to **Security > Search > Audit log search**
3. Ensure auditing is enabled

#### Step 2: Create Azure AD App Registration

1. Go to Azure Portal > Azure Active Directory
2. Create new App Registration
3. Grant API permissions:
   - Office 365 Management APIs: ActivityFeed.Read
   - ActivityFeed.ReadDlp (for DLP events)
4. Create client secret
5. Grant admin consent

### SIEM-Side Steps (Splunk)

#### Configure inputs.conf

```ini
[o365_management_activity://audit_exchange]
tenant_id = <TENANT_ID>
client_id = <CLIENT_ID>
client_secret = <CLIENT_SECRET>
content_types = Audit.Exchange,Audit.SharePoint
index = o365
interval = 300
```

## Required Add-on / Parser

| Component | Name | Purpose |
|-----------|------|---------|
| Add-on | Splunk_TA_ms_o365 | API collection and parsing |
| Index | o365 | Storage for M365 logs |

## Validation & Troubleshooting

### Verify Log Collection

```spl
index=o365 earliest=-1h
| stats count by sourcetype, Workload
```

### Common Issues

| Issue | Cause | Solution |
|-------|-------|----------|
| No data | Audit not enabled | Enable Unified Audit Logging |
| Permission denied | Missing API permissions | Grant admin consent |
| Partial data | Wrong content types | Add all required content types |

## Security Notes

1. M365 audit log retention varies by license
2. Rotate app registration secrets periodically
3. Use dedicated app registration for Splunk
4. Monitor for API throttling

---

*Last Updated: January 2025*  
*Version: 1.0 (Stub - Expand as needed)*
